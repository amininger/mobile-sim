sp {topstate*propose*init-agent
	(state <s> ^superstate nil
						 -^name)
-->
	(<s> ^operator <o> + >)
	(<o> ^name init-agent)
}

sp {topstate*apply*init-agent
   (state <s> ^superstate nil
              ^operator.name init-agent)
-->
   (<s> ^command-counter 0)
}

sp {substate*elaborate*io
	(state <s> ^superstate.io <io>)
-->
	(<s> ^io <io>)
}

sp {substate*elaborate*name
	(state <s> ^superstate.operator.name <name>)
-->
	(<s> ^name <name>)
}

sp {anystate*propose*wait
	(state <s> ^superstate <ss>
						 -^operator.name wait)
-->
	(<s> ^operator <o> + <)
	(<o> ^name wait)
}

sp {topstate*propose*do-command
	(state <s> ^superstate nil
						 ^current-command <cmd>)
	(<cmd> ^control-law <cl>)
-->
	(<s> ^operator <o> +)
	(<o> ^name do-command
			 ^command <cmd>)
}

sp {do-command*elaborate*command
	(state <s> ^name do-command
						 ^superstate.operator.command <cmd>)
-->
	(<s> ^command <cmd>)
}


sp {do-command*propose*send-command
	(state <s> ^name do-command
						 ^command <cmd>
                         -^sent)
-->
	(<s> ^operator <o> + >)
	(<o> ^name send-command
			 ^command <cmd>)
}

sp {do-command*apply*send-command*send
	(state <s> ^name do-command
     ^ol-command <cmd>
     ^operator.name send-command
						 ^operator <o>
						 ^io.output-link <out>)
-->
	(<out> ^do-control-law <cmd>)
    (<s> ^sent true)
}

sp {do-command*propose*complete-do-command
	(state <s> ^name do-command
						 ^ol-command.status << success failure unknown >>)
-->
	(<s> ^operator <o> + >)
	(<o> ^name complete-do-command)
}

sp {do-command*apply*complete-do-command
	(state <s> ^name do-command
						 ^operator.name complete-do-command
						 ^superstate <top>)
	(<top> ^current-command <cmd>
        ^command-counter <c>)
	(<cmd> ^next-command <next>)
-->
	(<top> ^current-command <cmd> -
			   ^current-command <next>)
    (<top> ^command-counter <c> -
           ^command-counter (+ <c> 1))
}

sp {do-command*apply*complete-do-command*remove*command
	(state <s> ^name do-command
						 ^operator.name complete-do-command
						 ^ol-command <cmd>
						 ^io.output-link <out>)
	(<out> ^do-control-law <cmd>)
-->
	(<out> ^do-control-law <cmd> -)
}


